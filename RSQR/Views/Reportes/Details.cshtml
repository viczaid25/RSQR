@model RSQR.Models.Reporte

@{
    ViewData["Title"] = "Report Details";
}

<div class="content-wrapper">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="display-6 text-dark fw-bold">Report Details</h1>
            <div>
                <a asp-action="Edit" asp-route-id="@Model?.Id" class="btn btn-warning rounded-pill">
                    <i class="fas fa-edit me-1"></i> Edit
                </a>
                <a asp-action="Index" class="btn btn-secondary rounded-pill ms-2">
                    <i class="fas fa-arrow-left me-1"></i> Back to list
                </a>
            </div>
        </div>

        <!-- Basic Information -->
        <div class="card shadow-sm rounded-lg mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Basic Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.Fecha)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.Fecha)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.ProblemRank)</dt>
                            <dd class="col-sm-8">
                                <span class="badge bg-@GetProblemRankBadgeColor(Model.ProblemRank)">
                                    @Html.DisplayFor(model => model.ProblemRank)
                                </span>
                            </dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.UserName)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.UserName)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.Linea)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.Linea)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.Tipo)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.Tipo)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.NombreCar)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.NombreCar)</dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.TituloProblema)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.TituloProblema)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.CincoM)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.CincoM)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.NumParteAfectado)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.NumParteAfectado)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.Lote)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.Lote)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.Customer)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.Customer)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.CustomerClaimNumber)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.CustomerClaimNumber)</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- Problem Description -->
        <div class="card shadow-sm rounded-lg mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-align-left me-2"></i>Problem Description</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-12">
                        <dl class="row">
                            <dt class="col-sm-2 text-muted">@Html.DisplayNameFor(model => model.Descripcion)</dt>
                            <dd class="col-sm-10">@Html.DisplayFor(model => model.Descripcion)</dd>

                            <dt class="col-sm-2 text-muted">@Html.DisplayNameFor(model => model.DescripcionProblema)</dt>
                            <dd class="col-sm-10">@Html.DisplayFor(model => model.DescripcionProblema)</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customer Information -->
        <div class="card shadow-sm rounded-lg mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-building me-2"></i>Customer Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.MotherFactory)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.MotherFactory)</dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.CustomerPartNumber)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.CustomerPartNumber)</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5W2H Analysis -->
        <div class="card shadow-sm rounded-lg mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-search me-2"></i>D2</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.QueP)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.QueP)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.QuienP)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.QuienP)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.DondeP)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.DondeP)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.CuandoP)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.CuandoP)</dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.PorqueP)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.PorqueP)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.ComoP)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.ComoP)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.CuantosP)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.CuantosP)</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- Containment -->
        <div class="card shadow-sm rounded-lg mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Containment</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="bg-light">
                            <tr>
                                <th>@Html.DisplayNameFor(model => model.ContencionItems)</th>
                                <th>@Html.DisplayNameFor(model => model.ContencionConsiderar)</th>
                                <th>@Html.DisplayNameFor(model => model.ContencionActivity)</th>
                                <th>@Html.DisplayNameFor(model => model.ContencionResponsable)</th>
                                <th>@Html.DisplayNameFor(model => model.ContencionTotalSuspeciousParts)</th>
                                <th>@Html.DisplayNameFor(model => model.ContencionOkParts)</th>
                                <th>@Html.DisplayNameFor(model => model.ContencionNgParts)</th>
                                <th>@Html.DisplayNameFor(model => model.ContencionEffectiveness)</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.ContencionItems.Count; i++)
                            {
                                <tr>
                                    <td>@Model.ContencionItems[i]</td>
                                    <td>@(Model.ContencionConsiderar.Count > i ? Model.ContencionConsiderar[i] : "")</td>
                                    <td>@(Model.ContencionActivity.Count > i ? Model.ContencionActivity[i] : "")</td>
                                    <td>@(Model.ContencionResponsable.Count > i ? Model.ContencionResponsable[i] : "")</td>
                                    <td>@(Model.ContencionTotalSuspeciousParts.Count > i ? Model.ContencionTotalSuspeciousParts[i] : "")</td>
                                    <td>@(Model.ContencionOkParts.Count > i ? Model.ContencionOkParts[i] : "")</td>
                                    <td>@(Model.ContencionNgParts.Count > i ? Model.ContencionNgParts[i] : "")</td>
                                    <td>@(Model.ContencionEffectiveness.Count > i ? Model.ContencionEffectiveness[i] : "")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Closing Information -->
        <div class="card shadow-sm rounded-lg mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-lock me-2"></i>Closing Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.Mileage)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.Mileage)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.InvestigationReport)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.InvestigationReport)</dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.DateOfClose)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.DateOfClose)</dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.ImpactoPPM)</dt>
                            <dd class="col-sm-8">
                                @if (Model.ImpactoPPM)
                                {
                                    <span class="badge bg-success">Yes</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">No</span>
                                }
                            </dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.Responsabilidad)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.Responsabilidad)</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="card shadow-sm rounded-lg mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>Actions</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.AlertaCalidad)</dt>
                            <dd class="col-sm-8">
                                @if (Model.AlertaCalidad)
                                {
                                    <span class="badge bg-success">Yes</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">No</span>
                                }
                            </dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.Disposicion)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.Disposicion)</dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.EntrevistaInvolucrados)</dt>
                            <dd class="col-sm-8">
                                @if (Model.EntrevistaInvolucrados)
                                {
                                    <span class="badge bg-success">Yes</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">No</span>
                                }
                            </dd>

                            <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.Comentarios)</dt>
                            <dd class="col-sm-8">@Html.DisplayFor(model => model.Comentarios)</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risk Assessment -->
        <div class="card shadow-sm rounded-lg mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Risk Assessment</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-2">
                        <dl class="row">
                            <dt class="col-sm-12 text-muted">@Html.DisplayNameFor(model => model.Severidad)</dt>
                            <dd class="col-sm-12">@Html.DisplayFor(model => model.Severidad)</dd>

                            <dt class="col-sm-12 text-muted">@Html.DisplayNameFor(model => model.Ocurrencia)</dt>
                            <dd class="col-sm-12">@Html.DisplayFor(model => model.Ocurrencia)</dd>

                            <dt class="col-sm-12 text-muted">@Html.DisplayNameFor(model => model.Deteccion)</dt>
                            <dd class="col-sm-12">@Html.DisplayFor(model => model.Deteccion)</dd>

                            <dt class="col-sm-12 text-muted">@Html.DisplayNameFor(model => model.AP_NPR)</dt>
                            <dd class="col-sm-12">@Html.DisplayFor(model => model.AP_NPR)</dd>
                        </dl>
                    </div>
                    <div class="col-md-5">
                        <dl class="row">
                            <dt class="col-sm-12 text-muted">@Html.DisplayNameFor(model => model.ModoFalla)</dt>
                            <dd class="col-sm-12">@Html.DisplayFor(model => model.ModoFalla)</dd>
                        </dl>
                    </div>
                    <div class="col-md-5">
                        <dl class="row">
                            <dt class="col-sm-12 text-muted">@Html.DisplayNameFor(model => model.ControlesEstablecidos)</dt>
                            <dd class="col-sm-12">@Html.DisplayFor(model => model.ControlesEstablecidos)</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- Photographic Evidence -->
        <div class="card shadow-sm rounded-lg mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-camera me-2"></i>Photographic Evidence</h5>
            </div>
            <div class="card-body">
                @if (Model.EvidenciaFotografica != null && Model.EvidenciaFotografica.Count > 0)
                {
                    <div class="row">
                        @foreach (var evidencia in Model.EvidenciaFotografica)
                        {
                            <div class="col-md-4 mb-3">
                                <div class="card h-100">
                                    <img src="data:image/jpeg;base64,@Convert.ToBase64String(evidencia)"
                                         class="card-img-top img-fluid"
                                         alt="Photographic evidence"
                                         style="max-height: 200px; object-fit: contain;">
                                    <div class="card-footer text-center">
                                        <small class="text-muted">Evidence @(Model.EvidenciaFotografica.IndexOf(evidencia) + 1)</small>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="alert alert-info mb-0">
                        No photographic evidence available
                    </div>
                }
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex justify-content-between mt-4">
            <a asp-controller="Reportes"
               asp-action="ExportToExcel"
               asp-route-id="@Model.Id"
               asp-route-linea="@Model.Linea"
               class="btn btn-primary rounded-pill">
                <i class="fas fa-file-excel me-1"></i> Download Report in Excel
            </a>

            <div>
                <a asp-action="Edit" asp-route-id="@Model?.Id" class="btn btn-warning rounded-pill">
                    <i class="fas fa-edit me-1"></i> Edit
                </a>
                <a asp-action="Index" class="btn btn-secondary rounded-pill ms-2">
                    <i class="fas fa-arrow-left me-1"></i> Back to list
                </a>
            </div>
        </div>
    </div>
</div>

@functions {
    public string GetProblemRankBadgeColor(string problemRank)
    {
        switch (problemRank?.ToUpper())
        {
            case "HIGH":
                return "danger";
            case "MEDIUM":
                return "warning";
            case "LOW":
                return "success";
            default:
                return "secondary";
        }
    }
}