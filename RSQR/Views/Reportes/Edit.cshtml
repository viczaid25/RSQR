@model RSQR.Models.Reporte

@{
    ViewData["Title"] = "Edit Report";
    var clientes = new List<string> {
        "DAIMLER", "FORD", "GENERAL MOTORS", "HITACHI ASTEMO", "HONDA",
        "JTEKT", "MAZDA", "NAVISTAR", "NISSAN", "PACCAR",
        "SCANIA", "STANLEY", "STELLANTIS", "VOLVO"
    };

    // Inicializar listas para Failure Mode
    Model.FmMode = Model.FmMode ?? new List<string>();
    Model.FmProcessName = Model.FmProcessName ?? new List<string>();
    Model.Fm6Ms = Model.Fm6Ms ?? new List<string>();
    Model.FmFactorUno = Model.FmFactorUno ?? new List<string>();
    Model.FmFactorDos = Model.FmFactorDos ?? new List<string>();
    Model.FmFactorTres = Model.FmFactorTres ?? new List<string>();
    Model.FmRelated = Model.FmRelated ?? new List<string>();
    Model.FmContentionActions = Model.FmContentionActions ?? new List<string>();

    // Inicializar listas para Preventive Actions
    Model.PreventiveCProcessName = Model.PreventiveCProcessName ?? new List<string>();
    Model.PreventiveCManpower = Model.PreventiveCManpower ?? new List<string>();
    Model.PreventiveCMethod = Model.PreventiveCMethod ?? new List<string>();
    Model.PreventiveCMachinary = Model.PreventiveCMachinary ?? new List<string>();
    Model.PreventiveCMaterial = Model.PreventiveCMaterial ?? new List<string>();
    Model.PreventiveCMeasurement = Model.PreventiveCMeasurement ?? new List<string>();
    Model.PreventiveCEnvironment = Model.PreventiveCEnvironment ?? new List<string>();
    Model.PreventiveCRank = Model.PreventiveCRank ?? new List<int>();

    // En la sección de inicialización del modelo
    Model.DetectionCProcessName = Model.DetectionCProcessName ?? new List<string>();
    Model.DetectionCManpower = Model.DetectionCManpower ?? new List<string>();
    Model.DetectionCMethod = Model.DetectionCMethod ?? new List<string>();
    Model.DetectionCMachinary = Model.DetectionCMachinary ?? new List<string>();
    Model.DetectionCMaterial = Model.DetectionCMaterial ?? new List<string>();
    Model.DetectionCMeasurement = Model.DetectionCMeasurement ?? new List<string>();
    Model.DetectionCEnvironment = Model.DetectionCEnvironment ?? new List<string>();
    Model.DetectionCRank = Model.DetectionCRank ?? new List<int>();

    // Inicializar listas para Occurrence
    Model.FactorUno = Model.FactorUno ?? new List<string>();
    Model.FactorUnoPrimerWhy = Model.FactorUnoPrimerWhy ?? new List<string>();
    Model.FactorUnoSegundoWhy = Model.FactorUnoSegundoWhy ?? new List<string>();
    Model.FactorUnoTercerWhy = Model.FactorUnoTercerWhy ?? new List<string>();
    Model.FactorUnoCuartoWhy = Model.FactorUnoCuartoWhy ?? new List<string>();
    Model.FactorUnoQuintoWhy = Model.FactorUnoQuintoWhy ?? new List<string>();
    Model.FactorUnoCorrectiveActions = Model.FactorUnoCorrectiveActions ?? new List<string>();

    // Inicializar listas para Detection
    Model.FactorDos = Model.FactorDos ?? new List<string>();
    Model.FactorDosPrimerWhy = Model.FactorDosPrimerWhy ?? new List<string>();
    Model.FactorDosSegundoWhy = Model.FactorDosSegundoWhy ?? new List<string>();
    Model.FactorDosTercerWhy = Model.FactorDosTercerWhy ?? new List<string>();
    Model.FactorDosCuartoWhy = Model.FactorDosCuartoWhy ?? new List<string>();
    Model.FactorDosQuintoWhy = Model.FactorDosQuintoWhy ?? new List<string>();
    Model.FactorDosCorrectiveActions = Model.FactorDosCorrectiveActions ?? new List<string>();

    // Inicializar listas para Systemic
    Model.FactorTres = Model.FactorTres ?? new List<string>();
    Model.FactorTresPrimerWhy = Model.FactorTresPrimerWhy ?? new List<string>();
    Model.FactorTresSegundoWhy = Model.FactorTresSegundoWhy ?? new List<string>();
    Model.FactorTresTercerWhy = Model.FactorTresTercerWhy ?? new List<string>();
    Model.FactorTresCuartoWhy = Model.FactorTresCuartoWhy ?? new List<string>();
    Model.FactorTresQuintoWhy = Model.FactorTresQuintoWhy ?? new List<string>();
    Model.FactorTresCorrectiveActions = Model.FactorTresCorrectiveActions ?? new List<string>();

    Model.OccurrenceItems = Model.OccurrenceItems ?? new List<string>();
    Model.OccurrenceAction = Model.OccurrenceAction ?? new List<string>();
    Model.OccurrenceResponsable = Model.OccurrenceResponsable ?? new List<string>();
    Model.OccurrenceDepartment = Model.OccurrenceDepartment ?? new List<string>();
    Model.OccurrenceOpeningDate = Model.OccurrenceOpeningDate ?? new List<DateTime>();
    Model.OccurrenceCloseDate = Model.OccurrenceCloseDate ?? new List<DateTime>();
    Model.OccurrenceAmef = Model.OccurrenceAmef ?? new List<string>();
    Model.OccurrenceCp = Model.OccurrenceCp ?? new List<string>();

    Model.DetectionItems = Model.DetectionItems ?? new List<string>();
    Model.DetectionAction = Model.DetectionAction ?? new List<string>();
    Model.DetectionResponsable = Model.DetectionResponsable ?? new List<string>();
    Model.DetectionDepartment = Model.DetectionDepartment ?? new List<string>();
    Model.DetectionOpeningDate = Model.DetectionOpeningDate ?? new List<DateTime>();
    Model.DetectionCloseDate = Model.DetectionCloseDate ?? new List<DateTime>();
    Model.DetectionAmef = Model.DetectionAmef ?? new List<string>();
    Model.DetectionCp = Model.DetectionCp ?? new List<string>();

    // Inicializar listas para Verification Occurrence
    Model.VerOccurrenceItems = Model.VerOccurrenceItems ?? new List<string>();
    Model.VerOccurrenceAction = Model.VerOccurrenceAction ?? new List<string>();
    Model.VerOccurrenceResponsable = Model.VerOccurrenceResponsable ?? new List<string>();
    Model.VerOccurrenceDepartment = Model.VerOccurrenceDepartment ?? new List<string>();
    Model.VerOccurrenceOpeningDate = Model.VerOccurrenceOpeningDate ?? new List<DateTime>();
    Model.VerOccurrenceCloseDate = Model.VerOccurrenceCloseDate ?? new List<DateTime>();
    Model.VerOccurrenceAmef = Model.VerOccurrenceAmef ?? new List<string>();
    Model.VerOccurrenceCp = Model.VerOccurrenceCp ?? new List<string>();

    // Inicializar listas para Verification Detection
    Model.VerDetectionItems = Model.VerDetectionItems ?? new List<string>();
    Model.VerDetectionAction = Model.VerDetectionAction ?? new List<string>();
    Model.VerDetectionResponsable = Model.VerDetectionResponsable ?? new List<string>();
    Model.VerDetectionDepartment = Model.VerDetectionDepartment ?? new List<string>();
    Model.VerDetectionOpeningDate = Model.VerDetectionOpeningDate ?? new List<DateTime>();
    Model.VerDetectionCloseDate = Model.VerDetectionCloseDate ?? new List<DateTime>();
    Model.VerDetectionAmef = Model.VerDetectionAmef ?? new List<string>();
    Model.VerDetectionCp = Model.VerDetectionCp ?? new List<string>();

    // Inicializar listas para D7D8
    Model.D7D8Sn = Model.D7D8Sn ?? new List<string>();
    Model.D7D8CodeDescription = Model.D7D8CodeDescription ?? new List<string>();
    Model.D7D8Responsible = Model.D7D8Responsible ?? new List<string>();
    Model.D7D8Deadline = Model.D7D8Deadline ?? new List<DateTime>();
    Model.D7D8ActualClosingDate = Model.D7D8ActualClosingDate ?? new List<DateTime>();
    Model.D7D8Comments = Model.D7D8Comments ?? new List<string>();


    int maxFmRows = new[] {
        Model.FmMode.Count,
        Model.FmProcessName.Count,
        Model.Fm6Ms.Count,
        Model.FmFactorUno.Count,
        Model.FmFactorDos.Count,
        Model.FmFactorTres.Count,
        Model.FmRelated.Count,
        Model.FmContentionActions.Count,
        Model.PreventiveCProcessName.Count,
        Model.PreventiveCManpower.Count,
        Model.PreventiveCMethod.Count,
        Model.PreventiveCMachinary.Count,
        Model.PreventiveCMaterial.Count,
        Model.PreventiveCMeasurement.Count,
        Model.PreventiveCEnvironment.Count,
        Model.PreventiveCRank.Count,
        Model.DetectionCProcessName.Count,
        Model.DetectionCManpower.Count,
        Model.DetectionCMethod.Count,
        Model.DetectionCMachinary.Count,
        Model.DetectionCMaterial.Count,
        Model.DetectionCMeasurement.Count,
        Model.DetectionCEnvironment.Count,
        Model.DetectionCRank.Count
    }.Max();

    if (maxFmRows == 0) { maxFmRows = 1; }
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="display-6 text-dark fw-bold">@ViewData["Title"]</h1>
    <a asp-action="Index" class="btn btn-outline-primary rounded-pill">
        <i class="fas fa-arrow-left me-1"></i> Back To List
    </a>
</div>

<div class="card shadow-sm border-0">
    <div class="card-body p-0">
        <div class="card shadow-sm rounded-lg mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>D0 Initial Notification</h5>
            </div>
            <div class="card-body">
                <form asp-action="Edit" method="post" enctype="multipart/form-data">
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger rounded-lg"></div>
                    <input type="hidden" asp-for="Id" />

                    <!-- Sección 1: Información Básica -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <input asp-for="Fecha" class="form-control" type="date" placeholder="Fecha" />
                                <label asp-for="Fecha">Date</label>
                                <span asp-validation-for="Fecha" class="text-danger small"></span>
                            </div>
                            <div class="form-floating mb-3">
                                <input asp-for="TituloProblema" class="form-control" placeholder="Título del Problema" />
                                <label asp-for="TituloProblema">Problem Title</label>
                                <span asp-validation-for="TituloProblema" class="text-danger small"></span>
                            </div>
                            <div class="form-floating mb-3">
                                <select asp-for="ProblemRank" class="form-select" asp-items="ViewBag.ProblemRankList"></select>
                                <label asp-for="ProblemRank">Clasification</label>
                                <span asp-validation-for="ProblemRank" class="text-danger small"></span>
                            </div>
                            <div class="form-floating mb-3">
                                <input asp-for="UserName" class="form-control" value="@ViewBag.DisplayName" readonly placeholder="Usuario" />
                                <label asp-for="UserName">Written Up</label>
                                <span asp-validation-for="UserName" class="text-danger small"></span>
                            </div>
                            <div class="form-floating mb-3">
                                <select asp-for="Linea" class="form-select" asp-items="ViewBag.LineaList">
                                    <option value=""></option>
                                </select>
                                <label asp-for="Linea">Business Unit</label>
                                <span asp-validation-for="Linea" class="text-danger small"></span>
                            </div>
                            <div class="form-floating mb-3">
                                <textarea asp-for="DescripcionProblema" class="form-control" style="height: 150px" placeholder="Descripción del problema"></textarea>
                                <label asp-for="DescripcionProblema">Problem Description</label>
                                <span asp-validation-for="DescripcionProblema" class="text-danger small"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <select asp-for="Tipo" class="form-select" asp-items="Html.GetEnumSelectList<TipoReporte>()"></select>
                                <label asp-for="Tipo">Type of Customer Claim</label>
                                <span asp-validation-for="Tipo" class="text-danger small"></span>
                            </div>
                            <div class="form-floating mb-3">
                                <select asp-for="Customer" class="form-select" id="customer-select" required>
                                    <option value="">-- Select a client --</option>
                                    @foreach (var cliente in clientes)
                                    {
                                        <option value="@cliente">@cliente</option>
                                    }
                                </select>
                                <label asp-for="Customer">Occurrence Place</label>
                                <span asp-validation-for="Customer" class="text-danger small"></span>
                            </div>
                            <div class="form-floating mb-3">
                                <input asp-for="NumParteAfectado" class="form-control" placeholder="Número de Parte Afectado" />
                                <label asp-for="NumParteAfectado">Affected Part Number</label>
                                <span asp-validation-for="NumParteAfectado" class="text-danger small"></span>
                            </div>
                            <div class="form-floating mb-3">
                                <input asp-for="CustomerPartNumber" class="form-control" placeholder="Número de Parte de Cliente" />
                                <label asp-for="CustomerPartNumber">Customer Part Number</label>
                                <span asp-validation-for="CustomerPartNumber" class="text-danger small"></span>
                            </div>
                            <div class="form-floating mb-3">
                                <input asp-for="Lote" class="form-control" placeholder="Numero de lote afectado" />
                                <label asp-for="Lote">Production Batch</label>
                                <span asp-validation-for="Lote" class="text-danger small"></span>
                            </div>
                            <!-- Campo oculto para el número de reclamo -->
                            <input type="hidden" asp-for="CustomerClaimNumber" id="claim-number" />

                            <!-- Campo de visualización del número de reclamo -->
                            <div class="form-floating mb-3">
                                <input class="form-control" id="claim-display" readonly placeholder="Número de Reclamo"
                                       value="@(Model.Customer + "-" + Model.CustomerClaimNumber.ToString("D4"))" />
                                <label>Claim Number</label>
                                <small class="form-text text-muted">Format: CLIENTE-0001</small>
                            </div>
                            <div class="form-floating mb-3">
                                <label class="form-label">Upload images</label>
                                <input type="file" name="EvidenciaFotografica" class="form-control" multiple />
                                <small class="form-text text-muted">You can select multiple files</small>
                                <span asp-validation-for="EvidenciaFotografica" class="text-danger small"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Sección 2: Detalles del Problema -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <select asp-for="CincoM" class="form-select" asp-items="Html.GetEnumSelectList<CincoMOpciones>()"></select>
                                <label asp-for="CincoM">6M</label>
                                <span asp-validation-for="CincoM" class="text-danger small"></span>
                            </div>
                        </div>
                        <div class="col-md-6">

                            <div class="form-floating mb-3">
                                <input asp-for="Descripcion" class="form-control" placeholder="Descripción" />
                                <label asp-for="Descripcion">Part Description</label>
                                <span asp-validation-for="Descripcion" class="text-danger small"></span>
                            </div>

                            <div class="form-floating mb-3">
                                <select asp-for="MotherFactory" class="form-control">
                                    <option value="">-- Select --</option>
                                    <option value="Himeji Office">Himeji Office</option>
                                    <option value="Sanda Office">Sanda Office</option>
                                </select>
                                <label asp-for="MotherFactory">Mother Factory</label>
                                <span asp-validation-for="MotherFactory" class="text-danger small"></span>
                            </div>

                        </div>
                    </div>

                    <!-- Sección 3: Análisis 5W2H -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-search me-2"></i>D2 Problem Description (5W2H)</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-floating mb-3">
                                        <input asp-for="QueP" class="form-control" placeholder="żQué problema fue detectado?" />
                                        <label asp-for="QueP">What problem was detected?</label>
                                        <span asp-validation-for="QueP" class="text-danger small"></span>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input asp-for="PorqueP" class="form-control" placeholder="żPor qué es un problema?" />
                                        <label asp-for="PorqueP">Why is it a problem?</label>
                                        <span asp-validation-for="PorqueP" class="text-danger small"></span>
                                    </div>


                                    <div class="form-floating mb-3">
                                        <input asp-for="DondeP" class="form-control" placeholder="żDónde se detecto el problema?" />
                                        <label asp-for="DondeP">Where was the problem detected?</label>
                                        <span asp-validation-for="DondeP" class="text-danger small"></span>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input asp-for="CuandoP" class="form-control" type="date" placeholder="żCuándo fue detectado el problema?" />
                                        <label asp-for="CuandoP">When was the problem detected?</label>
                                        <span asp-validation-for="CuandoP" class="text-danger small"></span>
                                    </div>

                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating mb-3">
                                        <input asp-for="QuienP" class="form-control" placeholder="żQuién detecto el problema?" />
                                        <label asp-for="QuienP">Who detected the problem?</label>
                                        <span asp-validation-for="QuienP" class="text-danger small"></span>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input asp-for="ComoP" class="form-control" placeholder="żCómo se detectó el problema?" />
                                        <label asp-for="ComoP">How was the problem detected?</label>
                                        <span asp-validation-for="ComoP" class="text-danger small"></span>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input asp-for="CuantosP" class="form-control" placeholder="żCuántas piezas fueron detectadas con el problema?" />
                                        <label asp-for="CuantosP">How many pieces were detected with the problem?</label>
                                        <span asp-validation-for="CuantosP" class="text-danger small"></span>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input asp-for="Mileage" class="form-control" placeholder="Mileage" />
                                        <label asp-for="Mileage">Mileage</label>
                                        <span asp-validation-for="Mileage" class="text-danger small"></span>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <input asp-for="InvestigationReport" class="form-control" placeholder="Investigation Report" />
                                        <label asp-for="InvestigationReport">Investigation Report</label>
                                        <span asp-validation-for="InvestigationReport" class="text-danger small"></span>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección 4: Contención -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>D3 Containment</h5>
                            <button type="button" id="add-group-btn" class="btn btn-sm btn-light rounded-pill">
                                <i class="fas fa-plus me-1"></i> Add group
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="dynamic-fields" class="row g-3">
                                @if (Model.ContencionItems != null && Model.ContencionItems.Count > 0)
                                {
                                    for (int i = 0; i < Model.ContencionItems.Count; i++)
                                    {
                                        <div class="col-md-12 mb-3 dynamic-field-group">
                                            <div class="card shadow-sm mb-3">
                                                <div class="card-body">
                                                    <div class="row g-3 flex-nowrap overflow-auto">
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <select name="ContencionConsiderar[@i]" class="form-select">
                                                                    <option value="Process" selected="@(i < Model.ContencionConsiderar.Count && Model.ContencionConsiderar[i] == "Process")">Process</option>
                                                                    <option value="Warehouse" selected="@(i < Model.ContencionConsiderar.Count && Model.ContencionConsiderar[i] == "Warehouse")">Warehouse</option>
                                                                    <option value="In Transit" selected="@(i < Model.ContencionConsiderar.Count && Model.ContencionConsiderar[i] == "In Transit")">In Transit</option>
                                                                    <option value="With Customer" selected="@(i < Model.ContencionConsiderar.Count && Model.ContencionConsiderar[i] == "With Customer")">With Customer</option>
                                                                </select>
                                                                <label>To Consider</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="ContencionActivity[@i]" class="form-control" placeholder="Contencion Activity"
                                                                       value="@(i < Model.ContencionActivity.Count ? Model.ContencionActivity[i] : "")" />
                                                                <label>Contencion Activity</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="ContencionResponsable[@i]" class="form-control" placeholder="Contencion Responsable"
                                                                       value="@(i < Model.ContencionResponsable.Count ? Model.ContencionResponsable[i] : "")" />
                                                                <label>Contencion Responsable</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="ContencionTotalSuspeciousParts[@i]" class="form-control" placeholder="Total Suspecious Parts"
                                                                       value="@(i < Model.ContencionTotalSuspeciousParts.Count ? Model.ContencionTotalSuspeciousParts[i] : "")" />
                                                                <label>Total Suspecious Parts</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="ContencionOkParts[@i]" class="form-control" placeholder="Ok Parts"
                                                                       value="@(i < Model.ContencionOkParts.Count ? Model.ContencionOkParts[i] : "")" />
                                                                <label>Ok Parts</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="ContencionNgParts[@i]" class="form-control" placeholder="NG Parts"
                                                                       value="@(i < Model.ContencionNgParts.Count ? Model.ContencionNgParts[i] : "")" />
                                                                <label>NG Parts</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="ContencionEffectiveness[@i]" class="form-control" placeholder="% Effectiveness"
                                                                       value="@(i < Model.ContencionEffectiveness.Count ? Model.ContencionEffectiveness[i] : "")" />
                                                                <label>% Effectiveness</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button type="button" class="btn btn-sm btn-outline-danger mt-2 remove-group-btn">
                                                        <i class="fas fa-trash me-1"></i> Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Failure Mode Identification Section -->
                    <div class="col-12">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 text-white"><i class="fas fa-exclamation-triangle me-2"></i>Failure Mode Identification</h6>
                                <button type="button" id="add-fm-row-btn" class="btn btn-sm btn-light rounded-pill">
                                    <i class="fas fa-plus me-1"></i> Add row
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="fm-dynamic-fields" class="row g-3">
                                    @for (int i = 0; i < maxFmRows; i++)
                                    {
                                        <div class="col-md-12 mb-3 fm-dynamic-field-group" data-index="@i">
                                            <div class="card shadow-sm mb-3">
                                                <div class="card-body">
                                                    <div class="row g-3">
                                                        <div class="col-md-3">
                                                            <div class="form-floating">
                                                                <input name="FmMode[@i]" class="form-control"
                                                                       value="@(i < Model.FmMode.Count ? Model.FmMode[i] : "")" />
                                                                <label>Failure Mode</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-floating">
                                                                <input name="FmProcessName[@i]" class="form-control fm-process-name"
                                                                       value="@(i < Model.FmProcessName.Count ? Model.FmProcessName[i] : "")" />
                                                                <label>Process Name</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <select name="Fm6Ms[@i]" class="form-select">
                                                                    <option value="">- Select -</option>
                                                                    <option value="Manpower" selected="@(i < Model.Fm6Ms.Count && Model.Fm6Ms[i] == "Manpower")">Manpower</option>
                                                                    <option value="Method" selected="@(i < Model.Fm6Ms.Count && Model.Fm6Ms[i] == "Method")">Method</option>
                                                                    <option value="Machinary" selected="@(i < Model.Fm6Ms.Count && Model.Fm6Ms[i] == "Machinary")">Machinary</option>
                                                                    <option value="Material" selected="@(i < Model.Fm6Ms.Count && Model.Fm6Ms[i] == "Material")">Material</option>
                                                                    <option value="Measurement" selected="@(i < Model.Fm6Ms.Count && Model.Fm6Ms[i] == "Measurement")">Measurement</option>
                                                                    <option value="Environment" selected="@(i < Model.Fm6Ms.Count && Model.Fm6Ms[i] == "Environment")">Environment</option>
                                                                </select>
                                                                <label>6Ms</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-floating">
                                                                <input name="FmFactorUno[@i]" class="form-control"
                                                                       value="@(i < Model.FmFactorUno.Count ? Model.FmFactorUno[i] : "")" />
                                                                <label>Factor 1</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-floating">
                                                                <input name="FmFactorDos[@i]" class="form-control"
                                                                       value="@(i < Model.FmFactorDos.Count ? Model.FmFactorDos[i] : "")" />
                                                                <label>Factor 2</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-floating">
                                                                <input name="FmFactorTres[@i]" class="form-control"
                                                                       value="@(i < Model.FmFactorTres.Count ? Model.FmFactorTres[i] : "")" />
                                                                <label>Factor 3</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-floating">
                                                                <select name="FmRelated[@i]" class="form-select fm-related">
                                                                    <option value="">- Select -</option>
                                                                    <option value="Y" selected="@(i < Model.FmRelated.Count && Model.FmRelated[i] == "Y")">Yes</option>
                                                                    <option value="N" selected="@(i < Model.FmRelated.Count && Model.FmRelated[i] == "N")">No</option>
                                                                </select>
                                                                <label>Related With The Issue?</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button type="button" class="btn btn-sm btn-outline-danger mt-2 remove-fm-row-btn">
                                                        <i class="fas fa-trash me-1"></i> Remove
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Preventive Actions Section -->
                    <div class="col-12" id="preventive-actions-section">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 text-white"><i class="fas fa-shield-alt me-2"></i>Preventive Actions</h6>
                                <button type="button" id="add-preventive-row-btn" class="btn btn-sm btn-light rounded-pill">
                                    <i class="fas fa-plus me-1"></i> Add row
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="preventive-dynamic-fields" class="row g-3">
                                    @for (int i = 0; i < Model.PreventiveCProcessName.Count; i++)
                                    {
                                        <div class="col-md-12 mb-3 preventive-dynamic-field-group" data-index="@i">
                                            <div class="card shadow-sm mb-3">
                                                <div class="card-body">
                                                    <div class="row g-3">
                                                        <div class="col-md-3">
                                                            <div class="form-floating">
                                                                <input name="PreventiveCProcessName[@i]" class="form-control preventive-process-name"
                                                                       value="@Model.PreventiveCProcessName[i]" />
                                                                <label>Process Name</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="PreventiveCManpower[@i]" class="form-control"
                                                                       value="@Model.PreventiveCManpower[i]" />
                                                                <label>Manpower</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="PreventiveCMethod[@i]" class="form-control"
                                                                       value="@Model.PreventiveCMethod[i]" />
                                                                <label>Method</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="PreventiveCMachinary[@i]" class="form-control"
                                                                       value="@Model.PreventiveCMachinary[i]" />
                                                                <label>Machinary</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="PreventiveCMaterial[@i]" class="form-control"
                                                                       value="@Model.PreventiveCMaterial[i]" />
                                                                <label>Material</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="PreventiveCMeasurement[@i]" class="form-control"
                                                                       value="@Model.PreventiveCMeasurement[i]" />
                                                                <label>Measurement</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="PreventiveCEnvironment[@i]" class="form-control"
                                                                       value="@Model.PreventiveCEnvironment[i]" />
                                                                <label>Environment</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="PreventiveCRank[@i]" type="number" class="form-control"
                                                                       value="@Model.PreventiveCRank[i]" />
                                                                <label>Rank [O]</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button type="button" class="btn btn-sm btn-outline-danger mt-2 remove-preventive-row-btn">
                                                        <i class="fas fa-trash me-1"></i> Remove
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detection Controls Section -->
                    <div class="col-12" id="detection-controls-section">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-warning text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 text-white"><i class="fas fa-search me-2"></i>Detection Controls</h6>
                                <button type="button" id="add-detection-row-btn" class="btn btn-sm btn-light rounded-pill">
                                    <i class="fas fa-plus me-1"></i> Add row
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="detection-dynamic-fields" class="row g-3">
                                    @for (int i = 0; i < Model.DetectionCProcessName.Count; i++)
                                    {
                                        <div class="col-md-12 mb-3 detection-dynamic-field-group" data-index="@i">
                                            <div class="card shadow-sm mb-3">
                                                <div class="card-body">
                                                    <div class="row g-3">
                                                        <div class="col-md-3">
                                                            <div class="form-floating">
                                                                <input name="DetectionCProcessName[@i]" class="form-control detection-process-name"
                                                                       value="@Model.DetectionCProcessName[i]" />
                                                                <label>Process Name</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="DetectionCManpower[@i]" class="form-control"
                                                                       value="@Model.DetectionCManpower[i]" />
                                                                <label>Manpower</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="DetectionCMethod[@i]" class="form-control"
                                                                       value="@Model.DetectionCMethod[i]" />
                                                                <label>Method</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="DetectionCMachinary[@i]" class="form-control"
                                                                       value="@Model.DetectionCMachinary[i]" />
                                                                <label>Machinary</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="DetectionCMaterial[@i]" class="form-control"
                                                                       value="@Model.DetectionCMaterial[i]" />
                                                                <label>Material</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="DetectionCMeasurement[@i]" class="form-control"
                                                                       value="@Model.DetectionCMeasurement[i]" />
                                                                <label>Measurement</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="DetectionCEnvironment[@i]" class="form-control"
                                                                       value="@Model.DetectionCEnvironment[i]" />
                                                                <label>Environment</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-floating">
                                                                <input name="DetectionCRank[@i]" type="number" class="form-control"
                                                                       value="@Model.DetectionCRank[i]" />
                                                                <label>Rank [D]</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button type="button" class="btn btn-sm btn-outline-danger mt-2 remove-detection-row-btn">
                                                        <i class="fas fa-trash me-1"></i> Remove
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Occurrence (Technical Root Cause) Section -->
                    <div class="col-12" id="occurrence-section">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 text-white"><i class="fas fa-search-plus me-2"></i>Occurrence (Technical Root Cause)</h6>
                                <button type="button" id="add-occurrence-row-btn" class="btn btn-sm btn-light rounded-pill">
                                    <i class="fas fa-plus me-1"></i> Add row
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="occurrence-dynamic-fields" class="row g-3">
                                    @for (int i = 0; i < Model.FactorUno.Count; i++)
                                    {
                                        <div class="col-md-12 mb-3 occurrence-dynamic-field-group" data-index="@i">
                                            <div class="card shadow-sm mb-3">
                                                <div class="card-body">
                                                    <h6 class="text-danger">Root Cause Analysis #@(i + 1)</h6>
                                                    <div class="row g-3">
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorUno[@i]" class="form-control"
                                                                       value="@Model.FactorUno[i]" />
                                                                <label>Root Cause Factor</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorUnoPrimerWhy[@i]" class="form-control"
                                                                       value="@Model.FactorUnoPrimerWhy[i]" />
                                                                <label>1st Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorUnoSegundoWhy[@i]" class="form-control"
                                                                       value="@Model.FactorUnoSegundoWhy[i]" />
                                                                <label>2nd Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorUnoTercerWhy[@i]" class="form-control"
                                                                       value="@Model.FactorUnoTercerWhy[i]" />
                                                                <label>3rd Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorUnoCuartoWhy[@i]" class="form-control"
                                                                       value="@Model.FactorUnoCuartoWhy[i]" />
                                                                <label>4th Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorUnoQuintoWhy[@i]" class="form-control"
                                                                       value="@Model.FactorUnoQuintoWhy[i]" />
                                                                <label>5th Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <div class="form-floating">
                                                                <textarea name="FactorUnoCorrectiveActions[@i]" class="form-control"
                                                                          style="height: 100px">@Model.FactorUnoCorrectiveActions[i]</textarea>
                                                                <label>Corrective Actions</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button type="button" class="btn btn-sm btn-outline-danger mt-2 remove-occurrence-row-btn">
                                                        <i class="fas fa-trash me-1"></i> Remove
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detection (Technical Root Cause) Section -->
                    <div class="col-12" id="detection-root-cause-section">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 text-white"><i class="fas fa-search me-2"></i>Detection (Technical Root Cause)</h6>
                                <button type="button" id="add-detection-root-cause-btn" class="btn btn-sm btn-light rounded-pill">
                                    <i class="fas fa-plus me-1"></i> Add row
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="detection-root-cause-dynamic-fields" class="row g-3">
                                    @for (int i = 0; i < Model.FactorDos.Count; i++)
                                    {
                                        <div class="col-md-12 mb-3 detection-root-cause-dynamic-field-group" data-index="@i">
                                            <div class="card shadow-sm mb-3">
                                                <div class="card-body">
                                                    <h6 class="text-secondary">Detection Root Cause Analysis #@(i + 1)</h6>
                                                    <div class="row g-3">
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorDos[@i]" class="form-control"
                                                                       value="@Model.FactorDos[i]" />
                                                                <label>Root Cause Factor</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorDosPrimerWhy[@i]" class="form-control"
                                                                       value="@Model.FactorDosPrimerWhy[i]" />
                                                                <label>1st Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorDosSegundoWhy[@i]" class="form-control"
                                                                       value="@Model.FactorDosSegundoWhy[i]" />
                                                                <label>2nd Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorDosTercerWhy[@i]" class="form-control"
                                                                       value="@Model.FactorDosTercerWhy[i]" />
                                                                <label>3rd Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorDosCuartoWhy[@i]" class="form-control"
                                                                       value="@Model.FactorDosCuartoWhy[i]" />
                                                                <label>4th Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorDosQuintoWhy[@i]" class="form-control"
                                                                       value="@Model.FactorDosQuintoWhy[i]" />
                                                                <label>5th Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <div class="form-floating">
                                                                <textarea name="FactorDosCorrectiveActions[@i]" class="form-control"
                                                                          style="height: 100px">@Model.FactorDosCorrectiveActions[i]</textarea>
                                                                <label>Corrective Actions</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button type="button" class="btn btn-sm btn-outline-secondary mt-2 remove-detection-root-cause-btn">
                                                        <i class="fas fa-trash me-1"></i> Remove
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Systemic (Technical Root Cause) Section -->
                    <div class="col-12" id="systemic-root-cause-section">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 text-white"><i class="fas fa-sitemap me-2"></i>Systemic (Technical Root Cause)</h6>
                                <button type="button" id="add-systemic-root-cause-btn" class="btn btn-sm btn-light rounded-pill">
                                    <i class="fas fa-plus me-1"></i> Add row
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="systemic-root-cause-dynamic-fields" class="row g-3">
                                    @for (int i = 0; i < Model.FactorTres.Count; i++)
                                    {
                                        <div class="col-md-12 mb-3 systemic-root-cause-dynamic-field-group" data-index="@i">
                                            <div class="card shadow-sm mb-3">
                                                <div class="card-body">
                                                    <h6 class="text-dark">Systemic Root Cause Analysis #@(i + 1)</h6>
                                                    <div class="row g-3">
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorTres[@i]" class="form-control"
                                                                       value="@Model.FactorTres[i]" />
                                                                <label>Root Cause Factor</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorTresPrimerWhy[@i]" class="form-control"
                                                                       value="@Model.FactorTresPrimerWhy[i]" />
                                                                <label>1st Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorTresSegundoWhy[@i]" class="form-control"
                                                                       value="@Model.FactorTresSegundoWhy[i]" />
                                                                <label>2nd Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorTresTercerWhy[@i]" class="form-control"
                                                                       value="@Model.FactorTresTercerWhy[i]" />
                                                                <label>3rd Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorTresCuartoWhy[@i]" class="form-control"
                                                                       value="@Model.FactorTresCuartoWhy[i]" />
                                                                <label>4th Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-floating">
                                                                <input name="FactorTresQuintoWhy[@i]" class="form-control"
                                                                       value="@Model.FactorTresQuintoWhy[i]" />
                                                                <label>5th Why</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <div class="form-floating">
                                                                <textarea name="FactorTresCorrectiveActions[@i]" class="form-control"
                                                                          style="height: 100px">@Model.FactorTresCorrectiveActions[i]</textarea>
                                                                <label>Corrective Actions</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button type="button" class="btn btn-sm btn-outline-dark mt-2 remove-systemic-root-cause-btn">
                                                        <i class="fas fa-trash me-1"></i> Remove
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- D5 Permanent Corrective Actions Section -->
                    <div class="col-12" id="d5-permanent-corrective-actions">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0 text-white"><i class="fas fa-check-circle me-2"></i>D5 - Permanent Corrective Actions</h6>
                            </div>
                            <div class="card-body">

                                <!-- Occurrence Section -->
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0 text-white"><i class="fas fa-bolt me-2"></i>Occurrence</h6>
                                        <button type="button" id="add-occurrence-action-btn" class="btn btn-sm btn-light rounded-pill">
                                            <i class="fas fa-plus me-1"></i> Add row
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div id="occurrence-actions-dynamic-fields" class="row g-3">
                                            @for (int i = 0; i < Model.OccurrenceItems.Count; i++)
                                            {
                                                <div class="col-md-12 mb-3 occurrence-action-dynamic-field-group" data-index="@i">
                                                    <div class="card shadow-sm mb-3">
                                                        <div class="card-body">
                                                            <h6 class="text-success">Occurrence Action #@(i + 1)</h6>
                                                            <div class="row g-3">
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="OccurrenceItems[@i]" class="form-control"
                                                                               value="@Model.OccurrenceItems[i]" />
                                                                        <label>Action Item</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="OccurrenceAction[@i]" class="form-control"
                                                                               value="@Model.OccurrenceAction[i]" />
                                                                        <label>Corrective Action</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="OccurrenceResponsable[@i]" class="form-control"
                                                                               value="@Model.OccurrenceResponsable[i]" />
                                                                        <label>Responsible</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="OccurrenceDepartment[@i]" class="form-control"
                                                                               value="@Model.OccurrenceDepartment[i]" />
                                                                        <label>Department</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="OccurrenceOpeningDate[@i]" class="form-control" type="date"
                                                                               value="@(i < Model.OccurrenceOpeningDate.Count ? Model.OccurrenceOpeningDate[i].ToString("yyyy-MM-dd") : "")" />
                                                                        <label>Opening Date</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="OccurrenceCloseDate[@i]" class="form-control" type="date"
                                                                               value="@(i < Model.OccurrenceCloseDate.Count ? Model.OccurrenceCloseDate[i].ToString("yyyy-MM-dd") : "")" />
                                                                        <label>Close Date</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="OccurrenceAmef[@i]" class="form-control"
                                                                               value="@Model.OccurrenceAmef[i]" />
                                                                        <label>AMEF Update</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="OccurrenceCp[@i]" class="form-control"
                                                                               value="@Model.OccurrenceCp[i]" />
                                                                        <label>Control Plan Update</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <button type="button" class="btn btn-sm btn-outline-success mt-2 remove-occurrence-action-btn">
                                                                <i class="fas fa-trash me-1"></i> Remove
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>

                                <!-- Detection Section -->
                                <div class="card shadow-sm">
                                    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0 text-white"><i class="fas fa-search me-2"></i>Detection</h6>
                                        <button type="button" id="add-detection-action-btn" class="btn btn-sm btn-light rounded-pill">
                                            <i class="fas fa-plus me-1"></i> Add row
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div id="detection-actions-dynamic-fields" class="row g-3">
                                            @for (int i = 0; i < Model.DetectionItems.Count; i++)
                                            {
                                                <div class="col-md-12 mb-3 detection-action-dynamic-field-group" data-index="@i">
                                                    <div class="card shadow-sm mb-3">
                                                        <div class="card-body">
                                                            <h6 class="text-info">Detection Action #@(i + 1)</h6>
                                                            <div class="row g-3">
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="DetectionItems[@i]" class="form-control"
                                                                               value="@Model.DetectionItems[i]" />
                                                                        <label>Action Item</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="DetectionAction[@i]" class="form-control"
                                                                               value="@Model.DetectionAction[i]" />
                                                                        <label>Corrective Action</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="DetectionResponsable[@i]" class="form-control"
                                                                               value="@Model.DetectionResponsable[i]" />
                                                                        <label>Responsible</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="DetectionDepartment[@i]" class="form-control"
                                                                               value="@Model.DetectionDepartment[i]" />
                                                                        <label>Department</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="DetectionOpeningDate[@i]" class="form-control" type="date"
                                                                               value="@(i < Model.DetectionOpeningDate.Count ? Model.DetectionOpeningDate[i].ToString("yyyy-MM-dd") : "")" />
                                                                        <label>Opening Date</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="DetectionCloseDate[@i]" class="form-control" type="date"
                                                                               value="@(i < Model.DetectionCloseDate.Count ? Model.DetectionCloseDate[i].ToString("yyyy-MM-dd") : "")" />
                                                                        <label>Close Date</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="DetectionAmef[@i]" class="form-control"
                                                                               value="@Model.DetectionAmef[i]" />
                                                                        <label>AMEF Update</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="DetectionCp[@i]" class="form-control"
                                                                               value="@Model.DetectionCp[i]" />
                                                                        <label>Control Plan Update</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <button type="button" class="btn btn-sm btn-outline-info mt-2 remove-detection-action-btn">
                                                                <i class="fas fa-trash me-1"></i> Remove
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>

                                <!-- Detection Section -->
                                <div class="card shadow-sm">
                                    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0 text-white"><i class="fas fa-search me-2"></i>Impact on PPM</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-floating mb-3">
                                            <select asp-for="ImpactoPPM" class="form-select">
                                                <option value="true">Yes</option>
                                                <option value="false">No</option>
                                            </select>
                                            <label asp-for="ImpactoPPM">Does it impact PPM?</label>
                                            <span asp-validation-for="ImpactoPPM" class="text-danger small"></span>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <select asp-for="Responsabilidad" class="form-select" asp-items="Html.GetEnumSelectList<ResponsabilidadOpciones>()"></select>
                                            <label asp-for="Responsabilidad">Responsibility</label>
                                            <span asp-validation-for="Responsabilidad" class="text-danger small"></span>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- D6 Verification of Implementation of Permanent Corrective Action Section -->
                    <div class="col-12" id="d6-verification-corrective-actions">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0 text-white"><i class="fas fa-check-circle me-2"></i>D6 - Verification of Implementation of Permanent Corrective Action</h6>
                            </div>
                            <div class="card-body">

                                <!-- Ver Occurrence Section -->
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0 text-white"><i class="fas fa-bolt me-2"></i>Occurrence</h6>
                                        <button type="button" id="add-ver-occurrence-action-btn" class="btn btn-sm btn-light rounded-pill">
                                            <i class="fas fa-plus me-1"></i> Add row
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div id="ver-occurrence-actions-dynamic-fields" class="row g-3">
                                            @for (int i = 0; i < Model.VerOccurrenceItems.Count; i++)
                                            {
                                                <div class="col-md-12 mb-3 ver-occurrence-action-dynamic-field-group" data-index="@i">
                                                    <div class="card shadow-sm mb-3">
                                                        <div class="card-body">
                                                            <h6 class="text-primary">Verification Occurrence Action #@(i + 1)</h6>
                                                            <div class="row g-3">
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="VerOccurrenceItems[@i]" class="form-control"
                                                                               value="@Model.VerOccurrenceItems[i]" />
                                                                        <label>Action Item</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="VerOccurrenceAction[@i]" class="form-control"
                                                                               value="@Model.VerOccurrenceAction[i]" />
                                                                        <label>Corrective Action</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="VerOccurrenceResponsable[@i]" class="form-control"
                                                                               value="@Model.VerOccurrenceResponsable[i]" />
                                                                        <label>Responsible</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="VerOccurrenceDepartment[@i]" class="form-control"
                                                                               value="@Model.VerOccurrenceDepartment[i]" />
                                                                        <label>Department</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="VerOccurrenceOpeningDate[@i]" class="form-control" type="date"
                                                                               value="@(i < Model.VerOccurrenceOpeningDate.Count ? Model.VerOccurrenceOpeningDate[i].ToString("yyyy-MM-dd") : "")" />
                                                                        <label>Opening Date</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="VerOccurrenceCloseDate[@i]" class="form-control" type="date"
                                                                               value="@(i < Model.VerOccurrenceCloseDate.Count ? Model.VerOccurrenceCloseDate[i].ToString("yyyy-MM-dd") : "")" />
                                                                        <label>Close Date</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="VerOccurrenceAmef[@i]" class="form-control"
                                                                               value="@Model.VerOccurrenceAmef[i]" />
                                                                        <label>AMEF Update</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="VerOccurrenceCp[@i]" class="form-control"
                                                                               value="@Model.VerOccurrenceCp[i]" />
                                                                        <label>Control Plan Update</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <button type="button" class="btn btn-sm btn-outline-primary mt-2 remove-ver-occurrence-action-btn">
                                                                <i class="fas fa-trash me-1"></i> Remove
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>

                                <!-- Ver Detection Section -->
                                <div class="card shadow-sm">
                                    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0 text-white"><i class="fas fa-search me-2"></i>Detection</h6>
                                        <button type="button" id="add-ver-detection-action-btn" class="btn btn-sm btn-light rounded-pill">
                                            <i class="fas fa-plus me-1"></i> Add row
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div id="ver-detection-actions-dynamic-fields" class="row g-3">
                                            @for (int i = 0; i < Model.VerDetectionItems.Count; i++)
                                            {
                                                <div class="col-md-12 mb-3 ver-detection-action-dynamic-field-group" data-index="@i">
                                                    <div class="card shadow-sm mb-3">
                                                        <div class="card-body">
                                                            <h6 class="text-info">Verification Detection Action #@(i + 1)</h6>
                                                            <div class="row g-3">
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="VerDetectionItems[@i]" class="form-control"
                                                                               value="@Model.VerDetectionItems[i]" />
                                                                        <label>Action Item</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="VerDetectionAction[@i]" class="form-control"
                                                                               value="@Model.VerDetectionAction[i]" />
                                                                        <label>Corrective Action</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="VerDetectionResponsable[@i]" class="form-control"
                                                                               value="@Model.VerDetectionResponsable[i]" />
                                                                        <label>Responsible</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="VerDetectionDepartment[@i]" class="form-control"
                                                                               value="@Model.VerDetectionDepartment[i]" />
                                                                        <label>Department</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="VerDetectionOpeningDate[@i]" class="form-control" type="date"
                                                                               value="@(i < Model.VerDetectionOpeningDate.Count ? Model.VerDetectionOpeningDate[i].ToString("yyyy-MM-dd") : "")" />
                                                                        <label>Opening Date</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-floating">
                                                                        <input name="VerDetectionCloseDate[@i]" class="form-control" type="date"
                                                                               value="@(i < Model.VerDetectionCloseDate.Count ? Model.VerDetectionCloseDate[i].ToString("yyyy-MM-dd") : "")" />
                                                                        <label>Close Date</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="VerDetectionAmef[@i]" class="form-control"
                                                                               value="@Model.VerDetectionAmef[i]" />
                                                                        <label>AMEF Update</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-floating">
                                                                        <input name="VerDetectionCp[@i]" class="form-control"
                                                                               value="@Model.VerDetectionCp[i]" />
                                                                        <label>Control Plan Update</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <button type="button" class="btn btn-sm btn-outline-info mt-2 remove-ver-detection-action-btn">
                                                                <i class="fas fa-trash me-1"></i> Remove
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- D7 & D8 Preventive Activities and Standards Section -->
                    <div class="col-12" id="d7d8-preventive-activities">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0 text-white"><i class="fas fa-shield-alt me-2"></i>D7 & D8 - Preventive Activities and Standards to Ensure The Horizontality of Countermeasures</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-striped">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Documentation</th>
                                                <th>SN</th>
                                                <th>Code/Document Description</th>
                                                <th>Responsible</th>
                                                <th>Deadline</th>
                                                <th>Actual Closing Date</th>
                                                <th>Comments</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @{
                                                // Lista predefinida de documentos
                                                var predefinedDocs = new List<string> {
                                            "1.- AMEF of design",
                                            "2.- AMEF of process",
                                            "3.- Masters",
                                            "4.- Control plan",
                                            "5.- Maintenance plan",
                                            "6.- Procedure",
                                            "7.- Work Instruction",
                                            "8.- Inspection standards"
                                            };

                                                // Asegurar que las listas tienen al menos 8 elementos
                                                Model.D7D8Sn = Model.D7D8Sn ?? new List<string>();
                                                Model.D7D8CodeDescription = Model.D7D8CodeDescription ?? new List<string>();
                                                Model.D7D8Responsible = Model.D7D8Responsible ?? new List<string>();
                                                Model.D7D8Deadline = Model.D7D8Deadline ?? new List<DateTime>();
                                                Model.D7D8ActualClosingDate = Model.D7D8ActualClosingDate ?? new List<DateTime>();
                                                Model.D7D8Comments = Model.D7D8Comments ?? new List<string>();

                                                // Rellenar con valores vacíos si hay menos de 8 elementos
                                                while (Model.D7D8Sn.Count < 8) { Model.D7D8Sn.Add(""); }
                                                while (Model.D7D8CodeDescription.Count < 8) { Model.D7D8CodeDescription.Add(""); }
                                                while (Model.D7D8Responsible.Count < 8) { Model.D7D8Responsible.Add(""); }
                                                while (Model.D7D8Deadline.Count < 8) { Model.D7D8Deadline.Add(DateTime.MinValue); }
                                                while (Model.D7D8ActualClosingDate.Count < 8) { Model.D7D8ActualClosingDate.Add(DateTime.MinValue); }
                                                while (Model.D7D8Comments.Count < 8) { Model.D7D8Comments.Add(""); }
                                            }

                                            @for (int i = 0; i < 8; i++)
                                            {
                                                <tr>
                                                    <td>@predefinedDocs[i]</td>
                                                    <td>
                                                        <input type="text" class="form-control" name="D7D8Sn[@i]" value="@Model.D7D8Sn[i]" />
                                                    </td>
                                                    <td>
                                                        <input type="text" class="form-control" name="D7D8CodeDescription[@i]" value="@Model.D7D8CodeDescription[i]" />
                                                    </td>
                                                    <td>
                                                        <input type="text" class="form-control" name="D7D8Responsible[@i]" value="@Model.D7D8Responsible[i]" />
                                                    </td>
                                                    <td>
                                                        <input type="date" class="form-control" name="D7D8Deadline[@i]"
                                                               value="@(Model.D7D8Deadline[i] > DateTime.MinValue ? Model.D7D8Deadline[i].ToString("yyyy-MM-dd") : "")" />
                                                    </td>
                                                    <td>
                                                        <input type="date" class="form-control" name="D7D8ActualClosingDate[@i]"
                                                               value="@(Model.D7D8ActualClosingDate[i] > DateTime.MinValue ? Model.D7D8ActualClosingDate[i].ToString("yyyy-MM-dd") : "")" />
                                                    </td>
                                                    <td>
                                                        <input type="text" class="form-control" name="D7D8Comments[@i]" value="@Model.D7D8Comments[i]" />
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Approval and Status Section -->
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <select asp-for="Approval" class="form-select">
                                                <option value="">Select Approval Status</option>
                                                <option value="Approved">Approved</option>
                                                <option value="Pending">Pending</option>
                                                <option value="Rejected">Rejected</option>
                                            </select>
                                            <label asp-for="Approval">Approval</label>
                                            <span asp-validation-for="Approval" class="text-danger small"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <select asp-for="Status" class="form-select">
                                                <option value="">Select Status</option>
                                                <option value="Completed">Completed</option>
                                                <option value="In Progress">In Progress</option>
                                                <option value="Not Started">Not Started</option>
                                            </select>
                                            <label asp-for="Status">Status</label>
                                            <span asp-validation-for="Status" class="text-danger small"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 8: Analysis and Controls -->
                    <div class="col-12">
                        <div class="card shadow-sm mb-4">

                            <div class="card-body">


                                <!-- Mostrar las imágenes existentes -->
                                @if (ViewBag.ArchivosExistentes != null && ViewBag.ArchivosExistentes.Count > 0)
                                {
                                    <div class="mb-3">
                                        <label class="form-label">Existing Photographic Evidence</label>
                                        <div class="alert alert-info">
                                            <i class="bi bi-info-circle"></i> Check the images you want to keep. Unchecked images will be deleted when you save.
                                        </div>
                                        <div class="row">
                                            @foreach (dynamic evidencia in ViewBag.ArchivosExistentes)
                                            {
                                                <div class="col-md-3 mb-3">
                                                    <div class="card h-100">
                                                        <img src="data:image/jpeg;base64,@Convert.ToBase64String(evidencia.Data)"
                                                             class="card-img-top img-fluid"
                                                             alt="Photographic evidence"
                                                             style="max-height: 150px; object-fit: contain;">
                                                        <div class="card-footer text-center">
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox"
                                                                       name="ArchivosAMantener" value="@evidencia.Index" id="archivo-@evidencia.Index" checked>
                                                                <label class="form-check-label" for="archivo-@evidencia.Index">
                                                                    Keep Evidence @(evidencia.Index + 1)
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                }

                                <!-- Sección para nueva evidencia -->
                                <div class="form-group">
                                    <label class="control-label">Add New Photographic Evidence</label>
                                    <input type="file" class="form-control" name="EvidenciaFotografica" multiple
                                           accept=".jpg,.jpeg,.png,.gif,.pdf" />
                                    <small class="text-muted">You can select multiple files (max 5MB each, JPG, PNG, GIF or PDF)</small>
                                    <span asp-validation-for="EvidenciaFotografica" class="text-danger"></span>
                                </div>

                                <!-- Vista previa de nuevos archivos -->
                                <div id="preview-container" class="mt-3"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div class="col-12">
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg rounded-pill">
                                <i class="fas fa-save me-1"></i> Save Changes
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



@section Styles {
    <style>
        /* Fuente SF Pro (si está disponible, sino usa fuentes alternativas) */
        body, h1, h2, h3, h4, h5, h6, .form-floating > label {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            font-weight: 600; /* Semi-bold */
        }

            /* Estilo específico para el título principal */
            h1.display-6 {
                color: #000 !important; /* Negro puro */
                font-weight: 700 !important; /* Bold */
                letter-spacing: -0.5px;
                margin-bottom: 1rem;
            }

        /* Color primario más profesional */
        :root {
            --color-primary: #2c5fa8; /* Azul corporativo */
        }

        .bg-primary {
            background-color: var(--color-primary) !important;
        }

        .btn-primary {
            background-color: var(--color-primary);
            border-color: var(--color-primary);
        }

            .btn-primary:hover {
                background-color: var(--color-primary-light);
                border-color: var(--color-primary-light);
            }

        .btn-outline-primary {
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

            .btn-outline-primary:hover {
                background-color: var(--color-primary);
                border-color: var(--color-primary);
            }

        /* Color para los labels activos */
        .form-floating > .form-control:focus ~ label,
        .form-floating > .form-control:not(:placeholder-shown) ~ label,
        .form-floating > .form-select ~ label {
            color: var(--color-primary);
        }

        /* Resto de tus estilos... */
        .btn {
            position: relative;
            overflow: hidden;
        }

        .ripple-effect {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.7);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        @@keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Labels de formulario */
        .form-floating > label {
            color: #000 !important;
            font-weight: 600 !important;
            font-size: 0.95rem;
        }

        /* Estado activo/focus */
        .form-floating > .form-control:focus ~ label,
        .form-floating > .form-control:not(:placeholder-shown) ~ label,
        .form-floating > .form-select ~ label {
            color: #000 !important; /* Mantener negro al activarse */
            font-weight: 600 !important;
            transform: scale(0.85) translateY(-0.5rem) translateX(0.15rem);
        }

        /* Asegurar visibilidad de los inputs */
        .form-control, .form-select {
            background-color: #fff !important;
            border: 1px solid #ced4da;
            padding: 0.5rem 1rem;
        }

            .form-control::placeholder {
                color: #9e9e9e;
                font-weight: normal;
            }

        /* Estilo para los switches */
        .form-switch .form-check-input {
            width: 3em;
            height: 1.5em;
            margin-right: 0.5rem;
        }

        /* Sombras más pronunciadas para las tarjetas */
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
        }

            .card:hover {
                box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            }

        /* Estilo para subtítulos/tarjetas */
        .card-header h5 {
            color: #fff !important; /* Blanco para contraste con fondo azul */
            font-weight: 700 !important;
            font-size: 1.1rem;
            letter-spacing: 0.2px;
        }

        /* Bordes redondeados */
        .rounded-lg {
            border-radius: 1rem !important;
        }

        /* Espaciado mejorado */
        .dynamic-field-group {
            margin-bottom: 1.5rem;
        }
    </style>
}

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        // Pasar datos iniciales desde C# a JavaScript
        window.reportEditInitialData = {
            fmIndex: @maxFmRows,
            preventiveIndex: @(Model.PreventiveCProcessName?.Count ?? 0),
            detectionIndex: @(Model.DetectionCProcessName?.Count ?? 0),
            occurrenceIndex: @(Model.FactorUno?.Count ?? 0),
            detectionRootCauseIndex: @(Model.FactorDos?.Count ?? 0),
            systemicRootCauseIndex: @(Model.FactorTres?.Count ?? 0),
            occurrenceActionIndex: @(Model.OccurrenceItems?.Count ?? 0),
            detectionActionIndex: @(Model.DetectionItems?.Count ?? 0),
            verOccurrenceActionIndex: @(Model.VerOccurrenceItems?.Count ?? 0),
            verDetectionActionIndex: @(Model.VerDetectionItems?.Count ?? 0)
        };
    </script>

    <script src="~/js/reportEdit.js" asp-append-version="true"></script>
}