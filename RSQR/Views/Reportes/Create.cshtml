@*
  Vista mejorada para la creación de CAR (Corrective Action Reports)
  - Bootstrap 5 + TagHelpers
  - Tabs + Acordeones
  - Resumen offcanvas
  - Drag&Drop + previews para evidencias
  - D3 con Template e indexación correcta
  - UX: bloqueo doble envío, unsaved changes, tooltips, contador
*@
@model RSQR.Models.Reporte

@{
    ViewData["Title"] = "Create New Report";

    var clientes = new List<string> {
        "DAIMLER", "FORD", "GENERAL MOTORS", "HITACHI ASTEMO", "HONDA",
        "JTEKT", "MAZDA", "NAVISTAR", "NISSAN", "PACCAR",
        "SCANIA", "STANLEY", "STELLANTIS", "VOLVO"
    };
}

<!-- Barra de acciones sticky -->
<div class="position-sticky top-0 z-3 bg-white border-bottom py-2" style="--bs-border-color:#eee;">
    <div class="container-fluid d-flex gap-2 justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-2">
            <a asp-action="Index" class="btn btn-outline-secondary btn-sm rounded-pill">
                <i class="fas fa-arrow-left me-1"></i> Back
            </a>
            <span class="badge text-bg-light">Report Draft</span>
        </div>
        <div class="d-flex gap-2">
            <button type="button" id="btnSaveDraft" class="btn btn-outline-primary rounded-pill" data-bs-toggle="tooltip" title="Guardar sin enviar">
                <i class="fas fa-save me-1"></i> Save draft
            </button>
            <button type="submit" form="carForm" id="btnSubmit" class="btn btn-primary rounded-pill">
                <span class="spinner-border spinner-border-sm me-1 d-none" id="btnSpinner"></span>
                <i class="fas fa-save me-1"></i> Create Report
            </button>
            <button class="btn btn-outline-dark rounded-pill" type="button" data-bs-toggle="offcanvas" data-bs-target="#summaryCanvas">
                <i class="fas fa-list-ul me-1"></i> Summary
            </button>
        </div>
    </div>
</div>

<!-- Header -->
<div class="container-fluid my-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <h1 class="display-6 text-dark fw-bold">@ViewData["Title"]</h1>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3" id="carTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-d0" type="button" role="tab">D0 Initial</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-basic" type="button" role="tab">Basic Info</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-5w2h" type="button" role="tab">5W2H</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-d3" type="button" role="tab">D3 Containment</button>
        </li>
    </ul>

    <!-- Form -->
    <form asp-action="Create" method="post" enctype="multipart/form-data" id="carForm" novalidate>
        <div asp-validation-summary="ModelOnly" class="alert alert-danger rounded-lg"></div>

        <div class="tab-content">

            <!-- TAB: D0 -->
            <div class="tab-pane fade show active" id="tab-d0" role="tabpanel" tabindex="0">
                <div class="accordion" id="accD0">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="hdD0">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#colD0" aria-expanded="true">
                                D0 Initial Notification
                            </button>
                        </h2>
                        <div id="colD0" class="accordion-collapse collapse show" data-bs-parent="#accD0">
                            <div class="accordion-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Capture the initial notification details and make sure the customer is selected to generate the Claim Number.
                                </div>
                                <!-- Número de reclamo (generado automáticamente) -->
                                <input type="hidden" asp-for="CustomerClaimNumber" id="claim-number" />
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <div class="form-floating">
                                            <input class="form-control" id="claim-display" readonly placeholder="Claim Number" aria-describedby="claimHelp" />
                                            <label>Claim Number</label>
                                        </div>
                                        <div class="form-text" id="claimHelp">Format: CLIENT-0001</div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-floating">
                                            <select asp-for="Customer" class="form-select" id="customer-select" required aria-describedby="customerHelp">
                                                <option value="">-- Select a client --</option>
                                                @foreach (var c in clientes)
                                                {
                                                    <option value="@c">@c</option>
                                                }
                                            </select>
                                            <label asp-for="Customer">Occurrence Place</label>
                                        </div>
                                        <div class="text-danger small"><span asp-validation-for="Customer"></span></div>
                                        <div class="form-text" id="customerHelp">Choose the customer to create the claim sequence.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-floating">
                                            <select asp-for="Tipo" class="form-select" asp-items="Html.GetEnumSelectList<TipoReporte>()"></select>
                                            <label asp-for="Tipo">Type of Customer Claim</label>
                                        </div>
                                        <div class="text-danger small"><span asp-validation-for="Tipo"></span></div>
                                    </div>
                                </div>
                            </div><!-- /accordion-body -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: Basic Info -->
            <div class="tab-pane fade" id="tab-basic" role="tabpanel" tabindex="0">
                <fieldset class="card shadow-sm border-0 mb-4">
                    <legend class="card-header bg-primary text-white m-0 py-2 px-3">Basic Report Information</legend>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <input asp-for="Fecha" class="form-control" type="date" placeholder="Date" />
                                    <label asp-for="Fecha">Date</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="Fecha"></span></div>
                            </div>

                            <div class="col-md-5">
                                <div class="form-floating">
                                    <input asp-for="TituloProblema" class="form-control" placeholder="Title" />
                                    <label asp-for="TituloProblema" class="required">Problem Title</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="TituloProblema"></span></div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-floating">
                                    <select asp-for="ProblemRank" class="form-select" asp-items="ViewBag.ProblemRankList"></select>
                                    <label asp-for="ProblemRank">Classification</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="ProblemRank"></span></div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input asp-for="UserName" class="form-control" value="@ViewBag.DisplayName" readonly placeholder="User" />
                                    <label asp-for="UserName">Written Up</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="UserName"></span></div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-floating">
                                    <select asp-for="Linea" class="form-select" asp-items="ViewBag.LineaList">
                                        <option value=""></option>
                                    </select>
                                    <label asp-for="Linea">Business Unit</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="Linea"></span></div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input asp-for="Descripcion" class="form-control" placeholder="Part description" />
                                    <label asp-for="Descripcion">Part Description</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="Descripcion"></span></div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-floating">
                                    <textarea asp-for="DescripcionProblema" class="form-control" id="txtDesc" maxlength="1000" style="height:150px" placeholder="Problem description"></textarea>
                                    <label asp-for="DescripcionProblema">Problem Description</label>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <div class="text-danger small"><span asp-validation-for="DescripcionProblema"></span></div>
                                    <div class="form-text"><span id="descCount">0</span>/1000</div>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-floating">
                                    <select asp-for="CincoM" class="form-select" asp-items="Html.GetEnumSelectList<CincoMOpciones>()"></select>
                                    <label asp-for="CincoM">6M</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="CincoM"></span></div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-floating">
                                    <select asp-for="MotherFactory" class="form-select">
                                        <option value="">-- Select --</option>
                                        <option value="Himeji Office">Himeji Office</option>
                                        <option value="Sanda Office">Sanda Office</option>
                                    </select>
                                    <label asp-for="MotherFactory">Mother Factory</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="MotherFactory"></span></div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input asp-for="NumParteAfectado" class="form-control" placeholder="Affected Part Number" />
                                    <label asp-for="NumParteAfectado" class="required">Affected Part Number</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="NumParteAfectado"></span></div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input asp-for="CustomerPartNumber" class="form-control" placeholder="Customer Part Number" />
                                    <label asp-for="CustomerPartNumber">Customer Part Number</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="CustomerPartNumber"></span></div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input asp-for="Lote" class="form-control" placeholder="Production batch" />
                                    <label asp-for="Lote">Production Batch</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="Lote"></span></div>
                            </div>

                            <!-- Evidencia fotográfica -->
                            <div class="col-12">
                                <label class="form-label">Upload images <span class="text-muted">(drag & drop or click)</span></label>
                                <div id="dropzone" class="border border-2 border-dashed rounded-3 p-4 text-center" aria-describedby="eviHelp" role="button" tabindex="0">
                                    <i class="fas fa-cloud-upload-alt fa-2x mb-2"></i>
                                    <div class="small text-muted">PNG, JPG. Multiple files allowed.</div>
                                    <input type="file" id="fileInput" name="EvidenciaFotografica" class="form-control d-none" multiple accept="image/*" />
                                </div>
                                <div class="form-text" id="eviHelp">Click or drop files in the box.</div>
                                <div id="previews" class="d-flex flex-wrap gap-2 mt-2"></div>
                                <div class="text-danger small"><span asp-validation-for="EvidenciaFotografica"></span></div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>

            <!-- TAB: 5W2H -->
            <div class="tab-pane fade" id="tab-5w2h" role="tabpanel" tabindex="0">
                <fieldset class="card shadow-sm border-0 mb-4">
                    <legend class="card-header bg-primary text-white m-0 py-2 px-3">D2 Problem Description (5W2H)</legend>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input asp-for="QueP" class="form-control" placeholder="What problem was detected?" />
                                    <label asp-for="QueP">What problem was detected?</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="QueP"></span></div>

                                <div class="form-floating mt-3">
                                    <input asp-for="PorqueP" class="form-control" placeholder="Why is it a problem?" />
                                    <label asp-for="PorqueP">Why is it a problem?</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="PorqueP"></span></div>

                                <div class="form-floating mt-3">
                                    <input asp-for="DondeP" class="form-control" placeholder="Where was the problem detected?" />
                                    <label asp-for="DondeP">Where was the problem detected?</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="DondeP"></span></div>

                                <div class="form-floating mt-3">
                                    <input asp-for="CuandoP" class="form-control" type="date" placeholder="When" />
                                    <label asp-for="CuandoP">When was the problem detected?</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="CuandoP"></span></div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input asp-for="QuienP" class="form-control" placeholder="Who detected the problem?" />
                                    <label asp-for="QuienP">Who detected the problem?</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="QuienP"></span></div>

                                <div class="form-floating mt-3">
                                    <input asp-for="ComoP" class="form-control" placeholder="How was it detected?" />
                                    <label asp-for="ComoP">How was the problem detected?</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="ComoP"></span></div>

                                <div class="form-floating mt-3">
                                    <input asp-for="CuantosP" class="form-control" inputmode="numeric" pattern="[0-9]*" placeholder="How many pieces?" />
                                    <label asp-for="CuantosP">How many pieces were detected?</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="CuantosP"></span></div>

                                <div class="form-floating mt-3">
                                    <input asp-for="Mileage" class="form-control" inputmode="numeric" placeholder="Mileage" />
                                    <label asp-for="Mileage">Mileage</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="Mileage"></span></div>

                                <div class="form-floating mt-3">
                                    <input asp-for="InvestigationReport" class="form-control" placeholder="Investigation Report" />
                                    <label asp-for="InvestigationReport">Investigation Report</label>
                                </div>
                                <div class="text-danger small"><span asp-validation-for="InvestigationReport"></span></div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>

            <!-- TAB: D3 Containment -->
            <div class="tab-pane fade" id="tab-d3" role="tabpanel" tabindex="0">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>D3 Containment</h5>
                        <div class="d-flex gap-2">
                            <!-- antes: btn btn-sm btn-light -->
                            <button type="button" id="add-group-btn" class="btn btn-sm btn-outline-light rounded-pill">
                                <i class="fas fa-plus me-1"></i> Add group
                            </button>
                            <!-- antes: badge bg-light text-dark -->
                            <span class="badge bg-white bg-opacity-25 text-white" id="groupCount">0 items</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="dynamic-fields" class="vstack gap-3"></div>
                    </div>
                </div>
            </div>

        </div><!--/tab-content-->
    </form>
</div><!--/container-->
<!-- Offcanvas Summary -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="summaryCanvas" aria-labelledby="summaryLabel">
    <div class="offcanvas-header">
        <h5 id="summaryLabel" class="offcanvas-title">Report Summary</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body small">
        <div class="vstack gap-2">
            <div><span class="text-muted">Claim:</span> <span id="sum-claim" class="fw-semibold">—</span></div>
            <div><span class="text-muted">Customer:</span> <span id="sum-customer">—</span></div>
            <div><span class="text-muted">Part #:</span> <span id="sum-part">—</span></div>
            <div><span class="text-muted">Title:</span> <span id="sum-title">—</span></div>
            <div><span class="text-muted">Line:</span> <span id="sum-line">—</span></div>
        </div>
    </div>
</div>

<!-- Template D3 -->
<template id="tpl-containment">
    <div class="card shadow-sm dynamic-field-group">
        <div class="card-body">
            <div class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label required">To Consider</label>
                    <select class="form-select" data-name="ContencionConsiderar[{i}]">
                        <option>Process</option>
                        <option>Warehouse</option>
                        <option>In Transit</option>
                        <option>With Customer</option>
                    </select>
                </div>
                <div class="col-md-5">
                    <label class="form-label">Action</label>
                    <input class="form-control" data-name="ContencionAccion[{i}]" placeholder="Describe the action">
                </div>
                <div class="col-md-2">
                    <label class="form-label">Owner</label>
                    <input class="form-control" data-name="ContencionOwner[{i}]" placeholder="Name / Area">
                </div>
                <div class="col-md-2">
                    <label class="form-label">Due Date</label>
                    <input class="form-control" data-name="ContencionFecha[{i}]" type="date">
                </div>
            </div>
            <div class="d-flex justify-content-end mt-3">
                <button type="button" class="btn btn-sm btn-outline-danger remove-group-btn">
                    <i class="fas fa-trash me-1"></i> Delete
                </button>
            </div>
        </div>
    </div>
</template>

@section Styles {
    <style>
        body, h1, h2, h3, h4, h5, h6, .form-floating > label {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            font-weight: 600;
        }

            h1.display-6 {
                color: #000 !important;
                font-weight: 700 !important;
                letter-spacing: -.5px;
                margin-bottom: 1rem;
            }

        :root {
            --color-primary: #2c5fa8;
        }

        .bg-primary {
            background-color: var(--color-primary) !important;
        }

        .btn-primary {
            background-color: var(--color-primary);
            border-color: var(--color-primary);
        }

            .btn-primary:hover {
                filter: brightness(1.05);
            }

        .card {
            box-shadow: 0 4px 6px rgba(0,0,0,.1);
            transition: box-shadow .3s ease;
        }

            .card:hover {
                box-shadow: 0 10px 15px rgba(0,0,0,.1);
            }

        .required::after {
            content: " *";
            color: #dc3545;
        }

        .border-dashed {
            border-style: dashed !important;
        }

        .offcanvas .offcanvas-title {
            font-weight: 700;
        }

        .form-floating > .form-control:focus ~ label {
            opacity: .9
        }

        :focus-visible {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }
    </style>
}

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        (() => {
          const form = document.getElementById('carForm');
          const btnSubmit = document.getElementById('btnSubmit');
          const btnSpinner = document.getElementById('btnSpinner');

          // ===== Unsaved changes warning =====
          let dirty = false;
          form?.addEventListener('input', () => dirty = true);
          window.addEventListener('beforeunload', (e) => {
            if (dirty) { e.preventDefault(); e.returnValue = ''; }
          });

          // ===== Submit lock + spinner =====
          form?.addEventListener('submit', (e) => {
            if (!form.checkValidity()) { form.classList.add('was-validated'); e.preventDefault(); e.stopPropagation(); return; }
            btnSubmit.disabled = true; btnSpinner.classList.remove('d-none'); dirty = false;
          }, true);

          // ===== Summary live =====
          const $ = (s)=>document.querySelector(s);
          const map = [
            {src:'#claim-display', tgt:'#sum-claim'},
            {src:'#customer-select', tgt:'#sum-customer'},
            {src:'[name="NumParteAfectado"]', tgt:'#sum-part'},
            {src:'[name="TituloProblema"]', tgt:'#sum-title'},
            {src:'[name="Linea"]', tgt:'#sum-line'}
          ];
          map.forEach(m=>{
            const el = $(m.src), out = $(m.tgt);
            if(!el||!out) return;
            const update=()=> out.textContent = el.value || '—';
            el.addEventListener('input', update); el.addEventListener('change', update); update();
          });

          // ===== Claim number (debounced + abortable) =====
          const customerSelect = document.getElementById('customer-select');
          const displayField  = document.getElementById('claim-display');
          const numericField  = document.getElementById('claim-number');
          let debounceT; let aborter;
          customerSelect?.addEventListener('change', () => {
            const customer = customerSelect.value;
            displayField.value = customer ? 'Generating…' : ''; numericField.value = '';
            clearTimeout(debounceT);
            if (aborter) aborter.abort();
            if (!customer) return;
            debounceT = setTimeout(async () => {
              try {
                aborter = new AbortController();
                const resp = await fetch(`/Reportes/GetNextClaimNumber?customer=${encodeURIComponent(customer)}`, {signal: aborter.signal});
                if(!resp.ok) throw new Error('HTTP ' + resp.status);
                const data = await resp.json();
                numericField.value = data.nextNumber;
                displayField.value = `${customer}-${String(data.nextNumber).padStart(4,'0')}`;
                dirty = true;
              } catch (err) {
                if (err.name !== 'AbortError') { displayField.value = 'Error generating'; numericField.value=''; }
              }
            }, 350);
          });

          // ===== Drag & drop + previews =====
          const dz = document.getElementById('dropzone');
          const fi = document.getElementById('fileInput');
          const pv = document.getElementById('previews');

          const openFileDialog = ()=> fi.click();
          dz?.addEventListener('click', openFileDialog);
          dz?.addEventListener('keypress', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); openFileDialog(); }});
          dz?.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('bg-light'); });
          dz?.addEventListener('dragleave', () => dz.classList.remove('bg-light'));
          dz?.addEventListener('drop', e => {
            e.preventDefault(); dz.classList.remove('bg-light');
            if (!fi) return;
            fi.files = e.dataTransfer.files; renderPreviews();
          });
          fi?.addEventListener('change', renderPreviews);

          function renderPreviews(){
            pv.innerHTML = '';
            const files = fi.files ?? [];
            [...files].forEach(f=>{
              const url = URL.createObjectURL(f);
              const card = document.createElement('div');
              card.className = 'card p-1';
              card.style.width = '96px';
              card.innerHTML = `<img src="${url}" class="card-img-top rounded" style="height:70px;object-fit:cover;" alt="">
                                <div class="small text-truncate px-1" title="${f.name}">${f.name}</div>`;
              pv.appendChild(card);
            });
          }

          // ===== D3 Containment template =====
          let idx = 0;
          const btnAddGroup = document.getElementById('add-group-btn');
          const container = document.getElementById('dynamic-fields');
          const tpl = document.getElementById('tpl-containment');
          const groupCount = document.getElementById('groupCount');

          function updateCount(){ if(groupCount) groupCount.textContent = `${container?.children.length || 0} items`; }

          btnAddGroup?.addEventListener('click', () => {
            const node = tpl.content.cloneNode(true);
            node.querySelectorAll('[data-name]').forEach(el=>{
              el.setAttribute('name', el.getAttribute('data-name').replace('{i}', idx));
              el.removeAttribute('data-name');
            });
            container.appendChild(node);
            idx++; updateCount(); dirty = true;
          });

          container?.addEventListener('click', (e)=>{
            const btn = e.target.closest('.remove-group-btn');
            if (!btn) return;
            const card = btn.closest('.dynamic-field-group');
            card?.remove(); updateCount(); dirty = true;
          });

          // ===== Tooltips =====
          document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => new bootstrap.Tooltip(el));

          // ===== Contador de descripción =====
          (function(){
            const t=document.getElementById('txtDesc'), c=document.getElementById('descCount');
            if(t&&c){ const u=()=>c.textContent=t.value.length; t.addEventListener('input',u); u(); }
          })();

          // ===== Guardar borrador (solo ejemplo front) =====
          document.getElementById('btnSaveDraft')?.addEventListener('click', ()=>{
            // Aquí puedes hacer POST a una acción Draft si la tienes.
            // Por ahora solo marca no-dirty y muestra toast simple:
            dirty = false;
            const toast = document.createElement('div');
            toast.className='toast align-items-center text-bg-success border-0 position-fixed bottom-0 end-0 m-3';
            toast.role='alert'; toast.innerHTML=`<div class="d-flex"><div class="toast-body">Draft saved locally.</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>`;
            document.body.appendChild(toast);
            new bootstrap.Toast(toast, { delay: 2000 }).show();
          });

        })();
    </script>
}
